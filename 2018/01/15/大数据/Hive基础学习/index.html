<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用,十分适合数据仓库的统计分析。 安装安装不做介绍,主要依赖Hadoop环境。参考官网配置安装即可。此处以Hive-">
<meta name="keywords" content="hive">
<meta property="og:type" content="article">
<meta property="og:title" content="Hive基础学习">
<meta property="og:url" content="http://xwolf191.github.io/2018/01/15/大数据/Hive基础学习/index.html">
<meta property="og:site_name" content="Xwolf">
<meta property="og:description" content="hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用,十分适合数据仓库的统计分析。 安装安装不做介绍,主要依赖Hadoop环境。参考官网配置安装即可。此处以Hive-">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-07-19T00:23:27.962Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hive基础学习">
<meta name="twitter:description" content="hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用,十分适合数据仓库的统计分析。 安装安装不做介绍,主要依赖Hadoop环境。参考官网配置安装即可。此处以Hive-">





  
  
  <link rel="canonical" href="http://xwolf191.github.io/2018/01/15/大数据/Hive基础学习/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hive基础学习 | Xwolf</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e201c03696b77e30e2ed8c52937d5ccb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xwolf</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">IT编程学习</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xwolf191.github.io/2018/01/15/大数据/Hive基础学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xwolf">
      <meta itemprop="description" content="JAVAEE、大数据、人工智能学习">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xwolf">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Hive基础学习

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-01-15 15:45:00" itemprop="dateCreated datePublished" datetime="2018-01-15T15:45:00+08:00">2018-01-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-07-19 08:23:27" itemprop="dateModified" datetime="2020-07-19T08:23:27+08:00">2020-07-19</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/大数据/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2018/01/15/大数据/Hive基础学习/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/01/15/大数据/Hive基础学习/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">129k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">3:55</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用,十分适合数据仓库的统计分析。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>安装不做介绍,主要依赖Hadoop环境。参考官网配置安装即可。此处以Hive-2.3.0来展开。<br>主要是格式化元数据,执行 schematool -dbType mysql -initSchema 即可。</p>
<h1 id="命令行界面"><a href="#命令行界面" class="headerlink" title="命令行界面"></a>命令行界面</h1><p>hive命令行界面选项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ./hive --<span class="built_in">help</span> --service cli</span></span><br><span class="line">usage: hive</span><br><span class="line"> -d,--define &lt;key=value&gt;          Variable substitution to apply to Hive</span><br><span class="line">                                  commands. e.g. -d A=B or --define A=B</span><br><span class="line">    --database &lt;databasename&gt;     Specify the database to use</span><br><span class="line"> -e &lt;quoted-query-string&gt;         SQL from command line</span><br><span class="line"> -f &lt;filename&gt;                    SQL from files</span><br><span class="line"> -H,--help                        Print help information</span><br><span class="line">    --hiveconf &lt;property=value&gt;   Use value for given property</span><br><span class="line">    --hivevar &lt;key=value&gt;         Variable substitution to apply to Hive</span><br><span class="line">                                  commands. e.g. --hivevar A=B</span><br><span class="line"> -i &lt;filename&gt;                    Initialization SQL file</span><br><span class="line"> -S,--silent                      Silent mode in interactive shell</span><br><span class="line"> -v,--verbose                     Verbose mode (echo executed SQL to the</span><br><span class="line">                                  console)</span><br></pre></td></tr></table></figure>
<p>进入命令行界面,从Hive0.14开始beetline作为新的命令行界面(稍后介绍)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ./hive --service cli</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> &gt;hive <span class="built_in">set</span>;</span></span><br><span class="line">hive.optimize.skewjoin=false</span><br><span class="line">hive.optimize.skewjoin.compiletime=false</span><br><span class="line">hive.optimize.sort.dynamic.partition=false</span><br><span class="line">hive.optimize.union.remove=false</span><br><span class="line">hive.orc.cache.stripe.details.mem.size=256Mb</span><br><span class="line">hive.orc.cache.use.soft.references=false</span><br><span class="line">hive.orc.compute.splits.num.threads=10</span><br><span class="line">hive.orc.splits.allow.synthetic.fileid=true</span><br><span class="line">hive.orc.splits.directory.batch.ms=0</span><br><span class="line">hive.orc.splits.include.file.footer=false</span><br><span class="line">hive.orc.splits.include.fileid=true</span><br><span class="line">hive.orc.splits.ms.footer.cache.enabled=false</span><br><span class="line">hive.orc.splits.ms.footer.cache.ppd.enabled=true</span><br><span class="line">hive.order.columnalignment=true</span><br><span class="line">hive.orderby.position.alias=true</span><br><span class="line">hive.parquet.timestamp.skip.conversion=true</span><br><span class="line">hive.ppd.recognizetransivity=true</span><br><span class="line">hive.ppd.remove.duplicatefilters=true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;hive <span class="built_in">set</span> -v;</span></span><br><span class="line"></span><br><span class="line">env:HADOOP_PID_DIR=</span><br><span class="line">env:HADOOP_PORTMAP_OPTS=-Xmx512m </span><br><span class="line">env:HADOOP_PREFIX=/opt/hadoop/hadoop-2.7.4</span><br><span class="line">env:HADOOP_SECONDARYNAMENODE_OPTS=-Dhadoop.security.logger=INFO,RFAS -Dhdfs.audit.logger=INFO,NullAppender </span><br><span class="line">env:HADOOP_SECURE_DN_LOG_DIR=/</span><br><span class="line">env:HADOOP_SECURE_DN_PID_DIR=</span><br><span class="line">env:HADOOP_SECURE_DN_USER=</span><br><span class="line">env:HADOOP_USER_CLASSPATH_FIRST=true</span><br><span class="line">env:HADOOP_YARN_HOME=/opt/hadoop/hadoop-2.7.4</span><br><span class="line">env:HBASE_HOME=/opt/hadoop/hbase-1.3.1</span><br><span class="line">env:HISTCONTROL=ignoredups</span><br><span class="line">env:HISTSIZE=1000</span><br><span class="line">env:HIVE_AUX_JARS_PATH=/opt/hadoop/hive-2.3.0/lib</span><br><span class="line">env:HIVE_CONF_DIR=/opt/hadoop/hive-2.3.0/conf</span><br><span class="line">env:HIVE_HOME=/opt/hadoop/hive-2.3.0</span><br><span class="line">env:HOME=/root</span><br><span class="line">env:HOSTNAME=hadoop01</span><br><span class="line">env:JAVA_HOME=/usr/java/jdk1.8.0_144</span><br><span class="line">env:KAFKA_HOME=/opt/hadoop/kafka_2.12-0.11.0.1</span><br><span class="line">env:KYLIN_HOME=/opt/hadoop/kylin-2.2.0</span><br><span class="line">env:LANG=en_US.UTF-8</span><br><span class="line">env:LD_LIBRARY_PATH=:/opt/hadoop/hadoop-2.7.4/lib/native</span><br><span class="line">env:LESSOPEN=||/usr/bin/lesspipe.sh %s</span><br><span class="line">env:LOGNAME=root</span><br><span class="line"></span><br><span class="line">system:java.class.version=52.0</span><br><span class="line">system:java.endorsed.dirs=/usr/java/jdk1.8.0_144/jre/lib/endorsed</span><br><span class="line">system:java.ext.dirs=/usr/java/jdk1.8.0_144/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">system:java.home=/usr/java/jdk1.8.0_144/jre</span><br><span class="line">system:java.io.tmpdir=/tmp</span><br><span class="line">system:java.library.path=/opt/hadoop/hadoop-2.7.4/lib/native</span><br><span class="line">system:java.net.preferIPv4Stack=true</span><br><span class="line">system:java.runtime.name=Java(TM) SE Runtime Environment</span><br><span class="line">system:java.runtime.version=1.8.0_144-b01</span><br><span class="line">system:java.specification.name=Java Platform API Specification</span><br><span class="line">system:java.specification.vendor=Oracle Corporation</span><br><span class="line">system:java.specification.version=1.8</span><br><span class="line">system:java.util.logging.config.file=/opt/hadoop/hive-2.3.0/conf/parquet-logging.properties</span><br><span class="line">system:java.vendor=Oracle Corporation</span><br><span class="line">system:java.vendor.url=http://java.oracle.com/</span><br><span class="line">system:java.vendor.url.bug=http://bugreport.sun.com/bugreport/</span><br><span class="line">system:java.version=1.8.0_144</span><br><span class="line">system:java.vm.info=mixed mode</span><br><span class="line">system:java.vm.name=Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">system:java.vm.specification.name=Java Virtual Machine Specification</span><br><span class="line">system:java.vm.specification.vendor=Oracle Corporation</span><br><span class="line">system:java.vm.specification.version=1.8</span><br><span class="line">system:java.vm.vendor=Oracle Corporation</span><br><span class="line">system:java.vm.version=25.144-b01</span><br><span class="line">system:line.separator=</span><br><span class="line">system:log4j.configurationFile=hive-log4j2.properties</span><br><span class="line">system:os.arch=amd64</span><br><span class="line">system:os.name=Linux</span><br><span class="line">system:os.version=2.6.32-696.el6.x86_64</span><br><span class="line">system:path.separator=:</span><br><span class="line">system:proc_hivecli=</span><br></pre></td></tr></table></figure>
<p>set 命令会打印命名空间hivevar,hivecong,sytem和env中的所有变量。加上-v,会打印Hadoop中定义的所有属性,例如控制HDFS和MapReduce。</p>
<p>还可以查看指定变量的值.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> &gt;hive <span class="built_in">set</span> env:HOME;</span></span><br><span class="line">env:HOME=/root</span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;hive <span class="built_in">set</span> system:os.version;</span></span><br><span class="line">system:os.version=2.6.32-696.el6.x86_64</span><br></pre></td></tr></table></figure>
<p>自定义变量—define key=value。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ./hive -define username=LAOWANG;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> hive&gt; <span class="built_in">set</span> username;</span></span><br><span class="line">username=LAOWANG</span><br></pre></td></tr></table></figure>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><blockquote>
<ul>
<li>基本数据类型</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYINT</td>
<td style="text-align:center">1Byte</td>
<td style="text-align:center">-128 到 127</td>
</tr>
<tr>
<td style="text-align:center">SMALLINT</td>
<td style="text-align:center">2Byte</td>
<td style="text-align:center">-32,768 到 32,767</td>
</tr>
<tr>
<td style="text-align:center">INT/INTEGER</td>
<td style="text-align:center">4Byte</td>
<td style="text-align:center">-2,147,483,648 到 2,147,483,647</td>
</tr>
<tr>
<td style="text-align:center">BIGINT</td>
<td style="text-align:center">8Byte</td>
<td style="text-align:center">-9,223,372,036,854,775,808 到 9,223,372,036,854,775,807</td>
</tr>
<tr>
<td style="text-align:center">FLOAT</td>
<td style="text-align:center">4Byte</td>
<td style="text-align:center">单精度浮点数</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE</td>
<td style="text-align:center">8Byte</td>
<td style="text-align:center">双精度浮点数</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE PRECISION (v2.2.0+)</td>
<td style="text-align:center">8Byte</td>
<td style="text-align:center">DOUBLE的别名</td>
</tr>
<tr>
<td style="text-align:center">DECIMAL (v0.11.0)</td>
<td style="text-align:center"></td>
<td style="text-align:center">0.11.0有38个精度的数字,0.13.0开始用户可自定义精度</td>
</tr>
<tr>
<td style="text-align:center">NUMERIC(v3.0.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center">和DECIMAL一样</td>
</tr>
<tr>
<td style="text-align:center">BOOLEAN</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">BINARY(v0.8.0+)</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li>日期类型</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TIMESTAMP (v0.8.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">DATE  (v0.12.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">INTERVAL (v1.2.0+)</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li>字符串</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">STRING (v0.12.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">CHAR  (v0.13.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">VARCHAR (v0.12.0+)</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li>复合类型</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">arrays (v0.14+)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">maps  (v0.14+)</td>
<td style="text-align:center"></td>
<td style="text-align:center">MAP<primitive_type, data_type></primitive_type,></td>
</tr>
<tr>
<td style="text-align:center">structs (v0.12.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center">STRUCT<col_name : data_type [comment col_comment], ...></col_name></td>
</tr>
<tr>
<td style="text-align:center">union  (v0.7.0+)</td>
<td style="text-align:center"></td>
<td style="text-align:center">UNIONTYPE<data_type, data_type, ...></data_type,></td>
</tr>
</tbody>
</table>
</div>
<h1 id="Hive-DDL"><a href="#Hive-DDL" class="headerlink" title="Hive DDL"></a>Hive DDL</h1><h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><blockquote>
<ul>
<li>查看数据库</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#查看所有的数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hive&gt; show databases;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#查看模糊匹配的数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hive&gt; show databases like <span class="string">'t.*'</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#打印当前的数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive&gt; <span class="built_in">set</span> hive.cli.print.current.db=<span class="literal">true</span>;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">切换数据库</span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive (default)&gt; use test1;</span></span><br><span class="line">OK</span><br><span class="line">Time taken: 0.097 seconds</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#显示当前的数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive (test1)&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>创建数据库</li>
</ul>
</blockquote>
<p>语法:</p>
<p>CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name<br>  [COMMENT database_comment]<br>  [LOCATION hdfs_path]<br>  [WITH DBPROPERTIES (property_name=property_value, …)];</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#创建数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;hive  create database IF NOT EXISTS <span class="built_in">test</span> comment  <span class="string">'test database'</span> ;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#location指定db文件的位置,默认hive.metastore.warehouse.dir配置的路径.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive&gt; create database IF NOT EXISTS test2 comment <span class="string">'test database'</span> location <span class="string">'/hive/tests/test.db'</span> ;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>修改数据库</li>
</ul>
</blockquote>
<p>语法:</p>
<p>ALTER (DATABASE|SCHEMA) database_name SET DBPROPERTIES (property_name=property_value, …);   — ( 0.14.0以后可用)</p>
<p>ALTER (DATABASE|SCHEMA) database_name SET OWNER [USER|ROLE] user_or_role;<br> — (0.13.0 以后可用; SCHEMA added in Hive 0.14.0)</p>
<p>ALTER (DATABASE|SCHEMA) database_name SET LOCATION hdfs_path;<br> — (2.2.1, 2.4.0 以后可用)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看建库语句</span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive&gt; describe schema test1;</span></span><br><span class="line">OK</span><br><span class="line">test1	test database	hdfs://hn1/hive/tests	root	USER	</span><br><span class="line">Time taken: 0.043 seconds, Fetched: 1 row(s)</span><br><span class="line"><span class="meta">#</span><span class="bash">hive&gt; describe database test1;</span></span><br><span class="line">OK</span><br><span class="line">test1	test database	hdfs://hn1/hive/tests	root	USER	</span><br><span class="line">Time taken: 0.044 seconds, Fetched: 1 row(s)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改数据库</span></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;hive alter schema test1 <span class="built_in">set</span> dbproperties (<span class="string">'create_by'</span>=<span class="string">'xwolf'</span>,<span class="string">'create_time'</span>=<span class="string">'2018-01-15 20:35'</span>);</span></span><br></pre></td></tr></table></figure>
<p>修改完成后,查看mysql中元数据信息:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from DATABASE_PARAMS;</span><br><span class="line">+<span class="comment">-------+-------------+------------------+</span></span><br><span class="line">| DB_ID | PARAM_KEY   | PARAM_VALUE      |</span><br><span class="line">+<span class="comment">-------+-------------+------------------+</span></span><br><span class="line">|     7 | create_by   | xwolf            |</span><br><span class="line">|     7 | create_time | 2018-01-15 20:35 |</span><br><span class="line">+<span class="comment">-------+-------------+------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> DBS <span class="keyword">where</span> DB_ID = <span class="number">7</span>;</span><br><span class="line">+<span class="comment">-------+---------------+-----------------------+-------+------------+------------+</span></span><br><span class="line">| DB_ID | DESC          | DB_LOCATION_URI       | NAME  | OWNER_NAME | OWNER_TYPE |</span><br><span class="line">+<span class="comment">-------+---------------+-----------------------+-------+------------+------------+</span></span><br><span class="line">|     7 | test database | hdfs://hn1/hive/tests | test1 | root       | USER       |</span><br><span class="line">+<span class="comment">-------+---------------+-----------------------+-------+------------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>删除数据库</li>
</ul>
</blockquote>
<p>语法:<br>DROP (DATABASE|SCHEMA) [IF EXISTS] database_name [RESTRICT|CASCADE];</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">数据库中有表时无法删除</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">hive (test1)&gt; drop schema <span class="keyword">if</span> exists test1;</span></span><br><span class="line"></span><br><span class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. InvalidOperationException(message:Database test1 is not empty. One or more tables exist.)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">hive (test1)&gt; drop schema <span class="keyword">if</span> exists test1 restrict;</span></span><br><span class="line"></span><br><span class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. InvalidOperationException(message:Database test1 is not empty. One or more tables exist.)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">级联删除可删除所有关联的表和数据.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">hive (test1)&gt; drop database <span class="keyword">if</span> exists test1 cascade;</span></span><br><span class="line">OK</span><br><span class="line">Time taken: 2.623 seconds</span><br></pre></td></tr></table></figure>
<h2 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h2><blockquote>
<ul>
<li>创建表</li>
</ul>
</blockquote>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name    -- ( TEMPORARY 在0.14.0版本后可用)</span><br><span class="line">  [(col_name data_type [COMMENT col_comment], ... [constraint_specification])]</span><br><span class="line">  [COMMENT table_comment]</span><br><span class="line">  [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]</span><br><span class="line">  [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]</span><br><span class="line">  [SKEWED BY (col_name, col_name, ...)                  -- ( 0.10.0版本后可用)]</span><br><span class="line">     ON ((col_value, col_value, ...), (col_value, col_value, ...), ...)</span><br><span class="line">     [STORED AS DIRECTORIES]</span><br><span class="line">  [</span><br><span class="line">   [ROW FORMAT row_format] </span><br><span class="line">   [STORED AS file_format]</span><br><span class="line">     | STORED BY &apos;storage.handler.class.name&apos; [WITH SERDEPROPERTIES (...)]  -- (0.6.0后可用)</span><br><span class="line">  ]</span><br><span class="line">  [LOCATION hdfs_path]</span><br><span class="line">  [TBLPROPERTIES (property_name=property_value, ...)]   -- (0.6.0后可用)</span><br><span class="line">  [AS select_statement];   -- (0.5.0后可用; 不支持外部表)</span><br><span class="line"></span><br><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name</span><br><span class="line">  LIKE existing_table_or_view_name</span><br><span class="line">  [LOCATION hdfs_path];</span><br><span class="line"></span><br><span class="line">data_typ</span><br><span class="line">  : primitive_type</span><br><span class="line">  | array_type</span><br><span class="line">  | map_type</span><br><span class="line">  | struct_type</span><br><span class="line">  | union_type  -- (0.7.0后可用)</span><br><span class="line"></span><br><span class="line">primitive_type</span><br><span class="line">  : TINYINT</span><br><span class="line">  | SMALLINT</span><br><span class="line">  | INT</span><br><span class="line">  | BIGINT</span><br><span class="line">  | BOOLEAN</span><br><span class="line">  | FLOAT</span><br><span class="line">  | DOUBLE</span><br><span class="line">  | DOUBLE PRECISION -- (2.2.0后可用)</span><br><span class="line">  | STRING</span><br><span class="line">  | BINARY      -- (0.8.0后可用)</span><br><span class="line">  | TIMESTAMP   -- (0.8.0后可用)</span><br><span class="line">  | DECIMAL     -- (0.11.0后可用)</span><br><span class="line">  | DECIMAL(precision, scale)  -- (0.13.0后可用)</span><br><span class="line">  | DATE        -- (0.12.0后可用)</span><br><span class="line">  | VARCHAR     -- (0.12.0后可用)</span><br><span class="line">  | CHAR        -- (0.13.0后可用)</span><br><span class="line"></span><br><span class="line">array_type</span><br><span class="line">  : ARRAY &lt; data_type &gt;</span><br><span class="line"></span><br><span class="line">map_type</span><br><span class="line">  : MAP &lt; primitive_type, data_type &gt;</span><br><span class="line"></span><br><span class="line">struct_type</span><br><span class="line">  : STRUCT &lt; col_name : data_type [COMMENT col_comment], ...&gt;</span><br><span class="line"></span><br><span class="line">union_type</span><br><span class="line">   : UNIONTYPE &lt; data_type, data_type, ... &gt;  -- (0.7.0后可用)</span><br><span class="line"></span><br><span class="line">row_format</span><br><span class="line">  : DELIMITED [FIELDS TERMINATED BY char [ESCAPED BY char]] [COLLECTION ITEMS TERMINATED BY char]</span><br><span class="line">        [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</span><br><span class="line">        [NULL DEFINED AS char]   -- (0.13.0后可用)</span><br><span class="line">  | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]</span><br><span class="line"></span><br><span class="line">file_format:</span><br><span class="line">  : SEQUENCEFILE</span><br><span class="line">  | TEXTFILE    -- (Default, depending on hive.default.fileformat configuration)</span><br><span class="line">  | RCFILE      -- (0.6.0后可用)</span><br><span class="line">  | ORC         -- (0.11.0后可用)</span><br><span class="line">  | PARQUET     -- (0.13.0后可用)</span><br><span class="line">  | AVRO        -- (0.14.0后可用)</span><br><span class="line">  | INPUTFORMAT input_format_classname OUTPUTFORMAT output_format_classname</span><br><span class="line"></span><br><span class="line">constraint_specification:</span><br><span class="line">  : [, PRIMARY KEY (col_name, ...) DISABLE NOVALIDATE ]</span><br><span class="line">    [, CONSTRAINT constraint_name FOREIGN KEY (col_name, ...) REFERENCES table_name(col_name, ...) DISABLE NOVALIDATE</span><br></pre></td></tr></table></figure>
<h3 id="Hive存储格式"><a href="#Hive存储格式" class="headerlink" title="Hive存储格式"></a>Hive存储格式</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">存储格式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">STORED AS TEXTFILE</td>
<td style="text-align:center">存储为纯文本文件。TEXTFILE是默认的文件格式，除非配置参数hive.default.fileformat有不同的设置.使用DELIMITED 子句来读取分隔的文件。通过使用“转义”子句(如“转义\”)来转义分隔符字符如果您想使用能够包含这些分隔符字符的数据，那么就需要转义。还可以使用“NULL DEFINED AS”子句(默认为’\N’)指定一个自定义的NULL格式。</td>
</tr>
<tr>
<td style="text-align:center">STORED AS SEQUENCEFILE</td>
<td style="text-align:center">存储为压缩的序列文件。</td>
</tr>
<tr>
<td style="text-align:center">STORED AS ORC</td>
<td style="text-align:center">存储为ORC文件格式。支持ACID事务和基于成本的优化器(CBO)。存储列级元数据。</td>
</tr>
<tr>
<td style="text-align:center">STORED AS PARQUET</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">STORED AS AVRO</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">STORED AS RCFILE</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">STORED BY</td>
<td style="text-align:center">以非本地表格式存储。要创建或链接到一个非本地的表，例如一个由<a href="https://cwiki.apache.org/confluence/display/Hive/HBaseIntegration" target="_blank" rel="noopener">HBase</a>或<a href="https://cwiki.apache.org/confluence/display/Hive/Druid+Integration" target="_blank" rel="noopener">Druid</a>或<a href="https://cwiki.apache.org/confluence/display/Hive/AccumuloIntegration" target="_blank" rel="noopener">Accumulo</a>的表支持的表.有关此选项的更多信息，请参见<a href="https://cwiki.apache.org/confluence/display/Hive/StorageHandlers" target="_blank" rel="noopener">storagehandler</a>。</td>
</tr>
<tr>
<td style="text-align:center">INPUTFORMAT and OUTPUTFORMAT</td>
<td style="text-align:center">在file_format中，指定相应的InputFormat和OutputFormat类的名称作为字符串文字。例如,“org.apache.hadoop.hive.contrib.fileformat.base64.Base64TextInputFormat。对于LZO压缩，使用的值是 INPUTFORMAT“com.hadoop.mapred.DeprecatedLzoTextInputFormat” OUTPUTFORMAT“org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat”(<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+LZO" target="_blank" rel="noopener">见LZO压缩</a>)。</td>
</tr>
</tbody>
</table>
</div>
<h3 id="行格式化"><a href="#行格式化" class="headerlink" title="行格式化"></a>行格式化</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">格式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>RegEx</strong></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">ROW FORMAT SERDE ‘org.apache.hadoop.hive.serde2.RegexSerDe’ WITH SERDEPROPERTIES(“input.regex” = “<regex>“) STORED AS TEXTFILE;</regex></td>
<td style="text-align:center">存储为纯文本文件，由正则表达式翻译。下面的例子在默认的Apache Weblog格式中定义了一个表。CREATE TABLE apachelog (host STRING,identity STRING,user STRING,time STRING,request STRING,status STRING,size STRING,referer STRING,agent STRING)ROW FORMAT SERDE ‘org.apache.hadoop.hive.serde2.RegexSerDe’WITH SERDEPROPERTIES (“input.regex” = “(<sup><a href="#fn_" id="reffn_"></a></sup><em>) (<sup><a href="#fn_" id="reffn_"></a></sup></em>) (<sup><a href="#fn_" id="reffn_"></a></sup>*) (-</td>
<td>\<sup><a href="#fn_\\]*\\" id="reffn_\\]*\\">\\]*\\</a></sup>) (<sup><a href="#fn_ \" " id="reffn_ \"> \"</a></sup>*</td>
<td>\”<sup><a href="#fn_\" " id="reffn_\">\"</a></sup>*\”) (-</td>
<td>[0-9]*) (-</td>
<td>[0-9]<em>)(?: (<sup><a href="#fn_ \" " id="reffn_ \"> \"</a></sup></em></td>
<td>\”.<em>\”) (<sup><a href="#fn_ \" " id="reffn_ \"> \"</a></sup></em></td>
<td>\”.*\”))?”)</td>
</tr>
<tr>
<td style="text-align:center"><strong>JSON</strong></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">ROW FORMAT SERDE ‘org.apache.hive.hcatalog.data.JsonSerDe’ STORED AS TEXTFILE</td>
<td style="text-align:center">以JSON格式存储为纯文本文件。JSON文件的JsonSerDe在Hive 0.12和后面都可以使用。在一些发行版中，对hih编目-core的引用。jar是必需的。添加JAR /usr/lib/hive-hcatalog/lib/hive-hcatalog-core.jar; CREATE TABLE mytable(a string,b bigint，…)ROW FORMAT SERDE ‘org.apache.hive.hcatalog.data.JsonSerDe’ STORED AS TEXTFILE;</td>
</tr>
<tr>
<td style="text-align:center"><strong>CSV/TSV</strong></td>
</tr>
<tr>
<td style="text-align:center">ROW FORMAT SERDE ‘org.apache.hadoop.hive.serde2.OpenCSVSerde’ STORED AS TEXTFILE</td>
<td style="text-align:center">以CSV/TSV格式存储为纯文本文件。例子:      CREATE TABLE my_table(a string, b string, …) ROW FORMAT SERDE ‘org.apache.hadoop.hive.serde2.OpenCSVSerde’ WITH SERDEPROPERTIES ( “separatorChar” = “\t”, “quoteChar”=”‘“ ,”escapeChar”    = “\“) STORED AS TEXTFILE;    SerDe的默认属性是逗号分隔(CSV)文件。      这个SerDe适用于大多数CSV数据，但是不处理嵌入的新行。使用SerDe,org.apache.hadoop.hive.serde2.OpenCSVSerde指定完全限定类名。文档是基于原始文档:<a href="https://github.com/ogrodnek/csv-serde" target="_blank" rel="noopener">https://github.com/ogrodnek/csv-serde</a>  <strong>局限性</strong>    这个SerDe将所有列都处理为String类型。即使使用这个SerDe创建一个非string列类型的表，描述表的输出也会显示字符串列类型。类型信息是从SerDe检索的。要将列转换为表中所需的类型，可以在表上创建一个视图，该视图将转换为所需类型。</td>
</tr>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h4 id="普通表-native-managed-TABLE"><a href="#普通表-native-managed-TABLE" class="headerlink" title="普通表(native/managed TABLE)"></a>普通表(native/managed TABLE)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;hive  CREATE  TABLE test2.user_info  (id INT COMMENT <span class="string">'user id'</span> ,name STRING COMMENT <span class="string">'user name'</span>) COMMENT <span class="string">'user info'</span> ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="string">','</span> STORED AS TEXTFILE TBLPROPERTIES (<span class="string">'create_by'</span>=<span class="string">'xwolf'</span>,<span class="string">'create_time'</span>=<span class="string">'2018-01-16 14:40'</span>,<span class="string">'address'</span>=<span class="string">'BeiJing'</span>);</span></span><br></pre></td></tr></table></figure>
<p>查看mysql中元数据信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SELECT * FROM TBLS WHERE TBL_ID = 11;</span></span><br><span class="line">+--------+-------------+-------+------------------+-------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+</span><br><span class="line">| TBL_ID | CREATE_TIME | DB_ID | LAST_ACCESS_TIME | OWNER | RETENTION | SD_ID | TBL_NAME  | TBL_TYPE      | VIEW_EXPANDED_TEXT | VIEW_ORIGINAL_TEXT | IS_REWRITE_ENABLED |</span><br><span class="line">+--------+-------------+-------+------------------+-------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+</span><br><span class="line">|     11 |  1516083902 |     8 |                0 | root  |         0 |    11 | user_info | MANAGED_TABLE | NULL               | NULL               |                    |</span><br><span class="line">+--------+-------------+-------+------------------+-------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SELECT * FROM TABLE_PARAMS WHERE TBL_ID=11;</span></span><br><span class="line">+--------+-----------------------+------------------------+</span><br><span class="line">| TBL_ID | PARAM_KEY             | PARAM_VALUE            |</span><br><span class="line">+--------+-----------------------+------------------------+</span><br><span class="line">|     11 | COLUMN_STATS_ACCURATE | &#123;"BASIC_STATS":"true"&#125; |</span><br><span class="line">|     11 | address               | BeiJing                |</span><br><span class="line">|     11 | comment               | user info              |</span><br><span class="line">|     11 | create_by             | xwolf                  |</span><br><span class="line">|     11 | create_time           | 2018-01-16 14:40       |</span><br><span class="line">|     11 | numFiles              | 0                      |</span><br><span class="line">|     11 | numRows               | 0                      |</span><br><span class="line">|     11 | rawDataSize           | 0                      |</span><br><span class="line">|     11 | totalSize             | 0                      |</span><br><span class="line">|     11 | transient_lastDdlTime | 1516083902             |</span><br><span class="line">+--------+-----------------------+------------------------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#指定不同的分隔符</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;hive CREATE  TABLE test2.user_info_2 (id INT COMMENT <span class="string">'user id'</span> ,name STRING COMMENT <span class="string">'user name'</span>) COMMENT <span class="string">'user info2'</span> ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="string">'&amp;&amp;'</span> STORED AS TEXTFILE  TBLPROPERTIES (<span class="string">'create_by'</span>=<span class="string">'xwolf'</span>,<span class="string">'create_time'</span>=<span class="string">'2018-01-16 14:50'</span>,<span class="string">'address'</span>=<span class="string">'BeiJingSanYuanQiao'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#分别插入两条数据</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;hive insert into user_info values (1,<span class="string">'laowang'</span>),(2,<span class="string">'laoli'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;hive insert into user_info_2 values (1,<span class="string">'laowang'</span>),(2,<span class="string">'laoli'</span>);</span></span><br></pre></td></tr></table></figure>
<p>查看HDFS中的数据格式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#user_info</span><br><span class="line"></span><br><span class="line">1,laowang</span><br><span class="line">2,laoli</span><br><span class="line"></span><br><span class="line">#user_info_2</span><br><span class="line"></span><br><span class="line">1&amp;laowang</span><br><span class="line">2&amp;laoli</span><br></pre></td></tr></table></figure>
<p>可见可以通过ROW FORMAT来指定字段的分隔符.</p>
<h4 id="外部表"><a href="#外部表" class="headerlink" title="外部表"></a>外部表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> page_view_1(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">     page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">     ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>,</span><br><span class="line">     country <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'country of origination'</span>)</span><br><span class="line"> <span class="keyword">COMMENT</span> <span class="string">'This is the staging page view table'</span></span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'$'</span></span><br><span class="line"> <span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE</span><br><span class="line"> LOCATION <span class="string">'/hive/test/page_view_1.db'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改数据位置*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> page_view_1 <span class="keyword">set</span> LOCATION <span class="string">'/hive/test/page_view_1'</span>;</span><br></pre></td></tr></table></figure>
<p>在HDFS中指定目录即可查看到数据文件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*删除表*/</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> page_view_1;</span><br></pre></td></tr></table></figure>
<p>在HDFS中指定目录依然可以查看到数据文件,外部表删除只会删除元数据,数据文件依然存在.</p>
<h4 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h4><p>insert语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 通过查询插入Hive表中</span><br><span class="line"></span><br><span class="line">Standard syntax:</span><br><span class="line">INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...) [IF NOT EXISTS]] select_statement1 FROM from_statement;</span><br><span class="line">INSERT INTO TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 FROM from_statement;</span><br><span class="line"></span><br><span class="line">Hive extension (multiple inserts):</span><br><span class="line">FROM from_statement</span><br><span class="line">INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...) [IF NOT EXISTS]] select_statement1</span><br><span class="line">[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2]</span><br><span class="line">[INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2] ...;</span><br><span class="line">FROM from_statement</span><br><span class="line">INSERT INTO TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1</span><br><span class="line">[INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2]</span><br><span class="line">[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2] ...;</span><br><span class="line"> </span><br><span class="line">Hive extension (dynamic partition inserts):</span><br><span class="line">INSERT OVERWRITE TABLE tablename PARTITION (partcol1[=val1], partcol2[=val2] ...) select_statement FROM from_statement;</span><br><span class="line">INSERT INTO TABLE tablename PARTITION (partcol1[=val1], partcol2[=val2] ...) select_statement FROM from_statement;</span><br><span class="line"></span><br><span class="line">## 查询语句写入文件系统</span><br><span class="line"></span><br><span class="line">Standard syntax:</span><br><span class="line">INSERT OVERWRITE [LOCAL] DIRECTORY directory1</span><br><span class="line">  [ROW FORMAT row_format] [STORED AS file_format] (Note: Only available starting with Hive 0.11.0)</span><br><span class="line">  SELECT ... FROM ...</span><br><span class="line"> </span><br><span class="line">Hive extension (multiple inserts):</span><br><span class="line">FROM from_statement</span><br><span class="line">INSERT OVERWRITE [LOCAL] DIRECTORY directory1 select_statement1</span><br><span class="line">[INSERT OVERWRITE [LOCAL] DIRECTORY directory2 select_statement2] ...</span><br><span class="line"></span><br><span class="line">row_format</span><br><span class="line">  : DELIMITED [FIELDS TERMINATED BY char [ESCAPED BY char]] [COLLECTION ITEMS TERMINATED BY char]</span><br><span class="line">        [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</span><br><span class="line">        [NULL DEFINED AS char] (Note: Only available starting with Hive 0.13)</span><br><span class="line"></span><br><span class="line">#### 插入值</span><br><span class="line"></span><br><span class="line">Standard Syntax:</span><br><span class="line">INSERT INTO TABLE tablename [PARTITION (partcol1[=val1], partcol2[=val2] ...)] VALUES values_row [, values_row ...]</span><br><span class="line"> </span><br><span class="line">Where values_row is:</span><br><span class="line">( value [, value ...] )</span><br><span class="line">where a value is either null or any valid SQL literal</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*单分区建表语句*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view_2(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">     page_url <span class="keyword">STRING</span>, referer_url <span class="keyword">STRING</span>,</span><br><span class="line">     ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"> <span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line"> PARTITIONED <span class="keyword">BY</span>(country <span class="keyword">STRING</span>)</span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'@'</span></span><br><span class="line"> <span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*插入数据*/</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_2 </span><br><span class="line"> <span class="keyword">PARTITION</span> (country=<span class="string">'cn'</span>) <span class="keyword">VALUES</span> (<span class="number">1232232</span>,<span class="number">1</span>,<span class="string">'http://baidu.com'</span>,<span class="string">'http://jd.com'</span>,<span class="string">'124.2.2.2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_2 </span><br><span class="line"> <span class="keyword">PARTITION</span> (country=<span class="string">'us'</span>) <span class="keyword">VALUES</span> (<span class="number">189434</span>,<span class="number">2</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.2.1'</span>),</span><br><span class="line"> (<span class="number">1893</span>,<span class="number">21</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#查看数据</span></span></span><br><span class="line">hive (test2)&gt; select * from page_view_2 where country ='cn';</span><br><span class="line">OK</span><br><span class="line">1232232	1	http://baidu.com	http://jd.com	124.2.2.2	cn</span><br><span class="line">Time taken: 1.241 seconds, Fetched: 1 row(s)</span><br><span class="line"></span><br><span class="line">hive (test2)&gt; select * from page_view_2 where country ='us';</span><br><span class="line">OK</span><br><span class="line">189434	2	http://alibaba.com	http://taobao.com	134.4.2.1	us</span><br><span class="line">1893	21	http://163.com	http://132.com	143.43.34.41	us</span><br><span class="line">Time taken: 0.282 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure>
<p>查看HDFS中文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@hadoop02 datas]# hadoop fs -ls /hive/tests/test.db/page_view_2</span><br><span class="line">Found 2 items</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 19:46 /hive/tests/test.db/page_view_2/country=cn</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 19:48 /hive/tests/test.db/page_view_2/country=us</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*多分区建表*/</span></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view_3(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">     page_url <span class="keyword">STRING</span>, referer_url <span class="keyword">STRING</span>,</span><br><span class="line">     ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"> <span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line"> PARTITIONED <span class="keyword">BY</span>(<span class="keyword">status</span> <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'@'</span></span><br><span class="line"> <span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*插入数据*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_3 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'cn'</span>,<span class="keyword">status</span>=<span class="string">'1'</span>) <span class="keyword">VALUES</span> (<span class="number">1232232</span>,<span class="number">1</span>,<span class="string">'http://baidu.com'</span>,<span class="string">'http://jd.com'</span>,<span class="string">'124.2.2.2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_3 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'us'</span>,<span class="keyword">status</span>=<span class="string">'1'</span>) <span class="keyword">VALUES</span> (<span class="number">189434</span>,<span class="number">2</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.2.1'</span>),</span><br><span class="line"> (<span class="number">1893</span>,<span class="number">21</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_3 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'cn'</span>,<span class="keyword">status</span>=<span class="string">'2'</span>) <span class="keyword">VALUES</span> (<span class="number">189434</span>,<span class="number">2</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.2.1'</span>),</span><br><span class="line"> (<span class="number">1893</span>,<span class="number">21</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> /*查看数据*/</span><br><span class="line"> hive (test2)&gt; select * from page_view_3;</span><br><span class="line">OK</span><br><span class="line">1232232	1	http://baidu.com	http://jd.com	124.2.2.2	1	cn</span><br><span class="line">189434	2	http://alibaba.com	http://taobao.com	134.4.2.1	1	us</span><br><span class="line">1893	21	http://163.com	http://132.com	143.43.34.41	1	us</span><br><span class="line">189434	2	http://alibaba.com	http://taobao.com	134.4.2.1	2	cn</span><br><span class="line">1893	21	http://163.com	http://132.com	143.43.34.41	2	cn</span><br><span class="line">Time taken: 0.482 seconds, Fetched: 5 row(s)</span><br></pre></td></tr></table></figure>
<p>查看HDFS中文件,</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@hadoop02 datas]# hadoop fs -ls /hive/tests/test.db/page_view_3</span><br><span class="line">Found 2 items</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 20:03 /hive/tests/test.db/page_view_3/status=1</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 20:04 /hive/tests/test.db/page_view_3/status=2</span><br><span class="line">[root@hadoop02 datas]# hadoop fs -ls /hive/tests/test.db/page_view_3/status=1</span><br><span class="line">Found 2 items</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 20:03 /hive/tests/test.db/page_view_3/status=1/country=cn</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 20:04 /hive/tests/test.db/page_view_3/status=1/country=us</span><br><span class="line">[root@hadoop02 datas]# hadoop fs -ls /hive/tests/test.db/page_view_3/status=2</span><br><span class="line">Found 1 items</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-16 20:05 /hive/tests/test.db/page_view_3/status=2/country=cn</span><br></pre></td></tr></table></figure>
<p>可见多分区表的目录结构是嵌套的。</p>
<h4 id="桶表-Bucket-Table"><a href="#桶表-Bucket-Table" class="headerlink" title="桶表(Bucket Table)"></a>桶表(Bucket Table)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建桶表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view_4</span><br><span class="line">(viewTime <span class="built_in">INT</span>, </span><br><span class="line">userid <span class="built_in">BIGINT</span> <span class="keyword">COMMENT</span> <span class="string">'用户ID'</span>,</span><br><span class="line">page_url <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'网页URL'</span>, </span><br><span class="line">referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'用户IP'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'用户浏览信息'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(<span class="keyword">status</span> <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span>(userid) SORTED <span class="keyword">BY</span>(viewTime) <span class="keyword">INTO</span> <span class="number">5</span> BUCKETS</span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span></span><br><span class="line">   COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'#'</span></span><br><span class="line">   <span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'$'</span></span><br><span class="line"> <span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#查看表信息</span></span></span><br><span class="line">hive (test2)&gt; describe page_view_4;</span><br><span class="line">OK</span><br><span class="line">viewtime            	int                 	                    </span><br><span class="line">userid              	bigint              	??ID                </span><br><span class="line">page_url            	string              	??URL               </span><br><span class="line">referrer_url        	string              	                    </span><br><span class="line">ip                  	string              	??IP                </span><br><span class="line">status              	string              	                    </span><br><span class="line">country             	string              	                    </span><br><span class="line">	 	 </span><br><span class="line"><span class="meta">#</span><span class="bash"> Partition Information	 	 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> col_name            	data_type           	comment             </span></span><br><span class="line">	 	 </span><br><span class="line">status              	string              	                    </span><br><span class="line">country             	string</span><br></pre></td></tr></table></figure>
<p>发现中文乱码,查看元数据中表信息:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*字段注释默认为latin1字符集*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`COLUMNS_V2`</span> (</span><br><span class="line">  <span class="string">`CD_ID`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`COMMENT`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_bin <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`COLUMN_NAME`</span> <span class="built_in">varchar</span>(<span class="number">767</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_bin <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`TYPE_NAME`</span> mediumtext <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1,</span><br><span class="line">  <span class="string">`INTEGER_IDX`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`CD_ID`</span>,<span class="string">`COLUMN_NAME`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`COLUMNS_V2_N49`</span> (<span class="string">`CD_ID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`COLUMNS_V2_FK1`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`CD_ID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`CDS`</span> (<span class="string">`CD_ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`TABLE_PARAMS`</span> (</span><br><span class="line">  <span class="string">`TBL_ID`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`PARAM_KEY`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_bin <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`PARAM_VALUE`</span> mediumtext <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_bin,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`TBL_ID`</span>,<span class="string">`PARAM_KEY`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`TABLE_PARAMS_N49`</span> (<span class="string">`TBL_ID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`TABLE_PARAMS_FK1`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`TBL_ID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`TBLS`</span> (<span class="string">`TBL_ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改为utf8编码*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--修改表字段注解和表注解</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> COLUMNS_V2 <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="keyword">COMMENT</span> <span class="built_in">VARCHAR</span>(<span class="number">256</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TABLE_PARAMS <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> PARAM_VALUE MEDIUMTEXT <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除表,重新创建;也可以修改字段的注释信息*/</span></span><br><span class="line">hive (test2)&gt; describe page_view_4;</span><br><span class="line">OK</span><br><span class="line">viewtime            	int                 	                    </span><br><span class="line">userid              	bigint              	用户ID                </span><br><span class="line">page_url            	string              	网页URL               </span><br><span class="line">referrer_url        	string              	                    </span><br><span class="line">ip                  	string              	用户IP                </span><br><span class="line">status              	string              	                    </span><br><span class="line">country             	string              	                    </span><br><span class="line">	 	 </span><br><span class="line"><span class="comment"># Partition Information	 	 </span></span><br><span class="line"><span class="comment"># col_name            	data_type           	comment             </span></span><br><span class="line">	 	 </span><br><span class="line">status              	string              	                    </span><br><span class="line">country             	string              	                    </span><br><span class="line">Time taken: 0.128 seconds, Fetched: 13 row(s)</span><br></pre></td></tr></table></figure>
<p>插入测试数据:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_4 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'cn'</span>,<span class="keyword">status</span>=<span class="string">'2'</span>) <span class="keyword">VALUES</span></span><br><span class="line"> (<span class="number">189434</span>,<span class="number">2</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.21.10'</span>),</span><br><span class="line"> (<span class="number">189354</span>,<span class="number">21</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>),</span><br><span class="line">  (<span class="number">189355</span>,<span class="number">22</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.42'</span>),</span><br><span class="line">   (<span class="number">189356</span>,<span class="number">21</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.43'</span>),</span><br><span class="line">    (<span class="number">189357</span>,<span class="number">22</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.44'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_4 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'cn'</span>,<span class="keyword">status</span>=<span class="string">'1'</span>) <span class="keyword">VALUES</span></span><br><span class="line"> (<span class="number">1894341</span>,<span class="number">3</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.21.10'</span>),</span><br><span class="line"> (<span class="number">1893542</span>,<span class="number">31</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>),</span><br><span class="line">  (<span class="number">1893552</span>,<span class="number">32</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.42'</span>),</span><br><span class="line">   (<span class="number">1893563</span>,<span class="number">31</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.43'</span>),</span><br><span class="line">    (<span class="number">1893574</span>,<span class="number">32</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.44'</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE  <span class="keyword">TABLE</span> page_view_4 </span><br><span class="line"><span class="keyword">PARTITION</span> (country=<span class="string">'us'</span>,<span class="keyword">status</span>=<span class="string">'2'</span>) <span class="keyword">VALUES</span></span><br><span class="line"> (<span class="number">189435</span>,<span class="number">4</span>,<span class="string">'http://alibaba.com'</span>,<span class="string">'http://taobao.com'</span>,<span class="string">'134.4.21.10'</span>),</span><br><span class="line"> (<span class="number">189355</span>,<span class="number">41</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.41'</span>),</span><br><span class="line">  (<span class="number">189356</span>,<span class="number">42</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.42'</span>),</span><br><span class="line">   (<span class="number">1893566</span>,<span class="number">41</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.43'</span>),</span><br><span class="line">    (<span class="number">1893576</span>,<span class="number">42</span>,<span class="string">'http://163.com'</span>,<span class="string">'http://132.com'</span>,<span class="string">'143.43.34.44'</span>);</span><br></pre></td></tr></table></figure>
<p>查看HDFS中文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop02 ~]# hadoop fs -ls /hive/tests/test.db/page_view_4/status=2/country=us</span><br><span class="line">Found 5 items</span><br><span class="line">-rwxr-xr-x   2 root supergroup         87 2018-01-17 10:52 /hive/tests/test.db/page_view_4/status=2/country=us/000000_0</span><br><span class="line">-rwxr-xr-x   2 root supergroup        218 2018-01-17 10:52 /hive/tests/test.db/page_view_4/status=2/country=us/000001_0</span><br><span class="line">-rwxr-xr-x   2 root supergroup        218 2018-01-17 10:52 /hive/tests/test.db/page_view_4/status=2/country=us/000002_0</span><br><span class="line">-rwxr-xr-x   2 root supergroup         87 2018-01-17 10:52 /hive/tests/test.db/page_view_4/status=2/country=us/000003_0</span><br><span class="line">-rwxr-xr-x   2 root supergroup        157 2018-01-17 10:52 /hive/tests/test.db/page_view_4/status=2/country=us/000004_0</span><br></pre></td></tr></table></figure>
<p>可以看到有5个文件,即分为5个桶。</p>
<h4 id="临时表-Temporary-Table"><a href="#临时表-Temporary-Table" class="headerlink" title="临时表(Temporary  Table)"></a>临时表(Temporary  Table)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建临时表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> user_info_3 (<span class="keyword">id</span> <span class="built_in">INT</span> ,<span class="keyword">name</span> <span class="keyword">STRING</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user_info_3 <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'wang'</span>),(<span class="number">2</span>,<span class="string">'li'</span>);</span><br></pre></td></tr></table></figure>
<p>查看HDFS中数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop02 ~]# hadoop fs -ls /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db</span><br><span class="line">Found 5 items</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-17 10:42 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/Values__Tmp__Table__1</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-17 10:45 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/Values__Tmp__Table__2</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-17 10:47 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/Values__Tmp__Table__3</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2018-01-17 10:50 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/Values__Tmp__Table__4</span><br><span class="line">drwx------   - root supergroup          0 2018-01-17 11:46 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d</span><br><span class="line">[root@hadoop02 ~]# hadoop fs -ls /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d</span><br><span class="line">[root@hadoop02 ~]# hadoop fs -ls /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d</span><br><span class="line">Found 1 items</span><br><span class="line">drwx------   - root supergroup          0 2018-01-17 11:50 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d/.hive-staging_hive_2018-01-17_11-50-29_681_7822027368902956312-1</span><br><span class="line">[root@hadoop02 ~]# hadoop fs -ls /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d</span><br><span class="line">Found 1 items</span><br><span class="line">-rwx------   2 root supergroup         12 2018-01-17 11:51 /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d/000000_0</span><br><span class="line">[root@hadoop02 ~]# hadoop fs -text /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d/000000_0</span><br><span class="line">1wang</span><br><span class="line">2li</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># quit退出hive 命令界面,临时表数据被删除</span></span></span><br><span class="line">[root@hadoop02 ~]# hadoop fs -text /tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d/000000_0</span><br><span class="line">text: `/tmp/hive/root/2c1479e2-6881-4208-8163-fbe991e3071d/_tmp_space.db/d2cd813e-faa4-4554-9311-84fc30200d6d/000000_0': No such file or directory</span><br></pre></td></tr></table></figure>
<p>作为临时表创建的表只在当前会话中可见。数据将存储在用户的scratch目录中，并在会话结束时删除。<br>如果一个临时表是在数据库中已经存在的永久表的数据库/表名创建的，那么在该会话中，对该表的任何引用都将解析为临时表，而不是永久表。用户将无法访问该会话中的原始表，而无需删除临时表，或将其重命名为一个不冲突的名称。<br>临时表有以下限制:<br>不支持分区列。<br>不支持创建索引。</p>
<blockquote>
<ul>
<li>修改表</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*重命名表*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">RENAME</span> <span class="keyword">TO</span> new_table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*改变表的属性信息*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">SET</span> TBLPROPERTIES table_properties;</span><br><span class="line"> </span><br><span class="line">table_properties:</span><br><span class="line">  : (property_name = property_value, property_name = property_value, ... )</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表的注释*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">SET</span> TBLPROPERTIES (<span class="string">'comment'</span> = new_comment);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表的存储属性*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name CLUSTERED <span class="keyword">BY</span> (col_name, col_name, ...) [SORTED <span class="keyword">BY</span> (col_name, ...)]</span><br><span class="line">  <span class="keyword">INTO</span> num_buckets BUCKETS;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*添加SerDe属性*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">SET</span> SERDE serde_class_name [<span class="keyword">WITH</span> SERDEPROPERTIES serde_properties];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">SET</span> SERDEPROPERTIES serde_properties;</span><br><span class="line"></span><br><span class="line">serde_properties:</span><br><span class="line">  : (property_name = property_value, property_name = property_value, ... )</span><br><span class="line"></span><br><span class="line"><span class="comment">/*添加表约束*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name PRIMARY <span class="keyword">KEY</span> (<span class="keyword">column</span>, ...) <span class="keyword">DISABLE</span> <span class="keyword">NOVALIDATE</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="keyword">column</span>, ...) <span class="keyword">REFERENCES</span> table_name(<span class="keyword">column</span>, ...) <span class="keyword">DISABLE</span> <span class="keyword">NOVALIDATE</span> <span class="keyword">RELY</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*添加表分区*/</span> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] <span class="keyword">PARTITION</span> partition_spec [LOCATION <span class="string">'location'</span>][, <span class="keyword">PARTITION</span> partition_spec [LOCATION <span class="string">'location'</span>], ...];</span><br><span class="line"> </span><br><span class="line">partition_spec:</span><br><span class="line">  : (partition_column = partition_col_value, partition_column = partition_col_value, ...)</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*重命名分区*/</span></span><br><span class="line"> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">PARTITION</span> partition_spec <span class="keyword">RENAME</span> <span class="keyword">TO</span> <span class="keyword">PARTITION</span> partition_spec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*交换分区*/</span></span><br><span class="line"><span class="comment">-- Move partition from table_name_1 to table_name_2</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name_2 <span class="keyword">EXCHANGE</span> <span class="keyword">PARTITION</span> (partition_spec) <span class="keyword">WITH</span> <span class="keyword">TABLE</span> table_name_1;</span><br><span class="line"><span class="comment">-- multiple partitions</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name_2 <span class="keyword">EXCHANGE</span> <span class="keyword">PARTITION</span> (partition_spec, partition_spec2, ...) <span class="keyword">WITH</span> <span class="keyword">TABLE</span> table_name_1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*恢复分区 MSCK REPAIR TABLE*/</span></span><br><span class="line"></span><br><span class="line">MSCK <span class="keyword">REPAIR</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"> <span class="comment">--Amazon Elastic MapReduce (EMR)'s 版本中：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">RECOVER</span> <span class="keyword">PARTITIONS</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除分区*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] <span class="keyword">PARTITION</span> partition_spec[, <span class="keyword">PARTITION</span> partition_spec, ...]</span><br><span class="line">  [<span class="keyword">IGNORE</span> <span class="keyword">PROTECTION</span>] [<span class="keyword">PURGE</span>];            <span class="comment">-- (<span class="doctag">Note:</span> PURGE available in Hive 1.2.0 and later, IGNORE PROTECTION not available 2.0.0 and later)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*归档/解档分区*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ARCHIVE</span> <span class="keyword">PARTITION</span> partition_spec;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name UNARCHIVE <span class="keyword">PARTITION</span> partition_spec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*改变列名称/类型/位置/注释*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">CHANGE</span> [<span class="keyword">COLUMN</span>] col_old_name col_new_name column_type</span><br><span class="line">  [<span class="keyword">COMMENT</span> col_comment] [<span class="keyword">FIRST</span>|<span class="keyword">AFTER</span> column_name] [<span class="keyword">CASCADE</span>|RESTRICT];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*添加/替换字段*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name </span><br><span class="line">  [<span class="keyword">PARTITION</span> partition_spec]                 <span class="comment">-- (<span class="doctag">Note:</span> Hive 0.14.0 and later)</span></span><br><span class="line">  <span class="keyword">ADD</span>|<span class="keyword">REPLACE</span> <span class="keyword">COLUMNS</span> (col_name data_type [<span class="keyword">COMMENT</span> col_comment], ...)</span><br><span class="line">  [<span class="keyword">CASCADE</span>|RESTRICT]                         <span class="comment">-- (<span class="doctag">Note:</span> Hive 1.1.0 and later)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区 文件格式*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">SET</span> FILEFORMAT file_format;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区 位置*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">SET</span> LOCATION <span class="string">"new location"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区联系*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name TOUCH [<span class="keyword">PARTITION</span> partition_spec];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区的保护属性*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">ENABLE</span>|<span class="keyword">DISABLE</span> NO_DROP [<span class="keyword">CASCADE</span>];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">ENABLE</span>|<span class="keyword">DISABLE</span> <span class="keyword">OFFLINE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区的联系*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> (partition_key = <span class="string">'partition_value'</span> [, ...])] CONCATENATE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*修改表/分区压缩信息*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> (partition_key = <span class="string">'partition_value'</span> [, ...])]</span><br><span class="line">  <span class="keyword">COMPACT</span> <span class="string">'compaction_type'</span>[<span class="keyword">AND</span> <span class="keyword">WAIT</span>]</span><br><span class="line">  [<span class="keyword">WITH</span> OVERWRITE TBLPROPERTIES (<span class="string">"property"</span>=<span class="string">"value"</span> [, ...])];</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--新建一个和已存在表的结构一样的表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_info_4 <span class="keyword">LIKE</span> user_info_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看结构</span></span><br><span class="line">hive (test2)&gt; DESCRIBE user_info_4;</span><br><span class="line">OK</span><br><span class="line">id                  	int                 	user id             </span><br><span class="line">name                	string              	user name      </span><br><span class="line"></span><br><span class="line"><span class="comment">--重命名表</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info_4 <span class="keyword">RENAME</span> <span class="keyword">TO</span> user_info_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">--添加字段</span></span><br><span class="line"> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info_5 <span class="keyword">ADD</span> <span class="keyword">COLUMNS</span> (age <span class="built_in">INT</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>,<span class="keyword">status</span> <span class="built_in">INT</span> <span class="keyword">COMMENT</span> <span class="string">'状态'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改表注释</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info_5 <span class="keyword">SET</span> TBLPROPERTIES (<span class="string">'comment'</span> = <span class="string">'用户信息5表'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改表字段信息</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info_5 <span class="keyword">CHANGE</span> <span class="keyword">COLUMN</span> age ages <span class="built_in">INT</span> <span class="keyword">COMMENT</span> <span class="string">'用户年龄'</span> <span class="keyword">AFTER</span> <span class="keyword">status</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除字段(REPALCE)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info_5 <span class="keyword">REPLACE</span> <span class="keyword">COLUMNS</span> (<span class="keyword">id</span> <span class="built_in">int</span> ,<span class="keyword">name</span> <span class="keyword">String</span>,age <span class="built_in">INT</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>);</span><br></pre></td></tr></table></figure>
<p>其他分区操作,参考具体语法实例.</p>
<blockquote>
<ul>
<li>删除表</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*基础语法*/</span> </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] table_name [<span class="keyword">PURGE</span>];  <span class="comment">-- ( PURGE 0.14.0后可用)</span></span><br></pre></td></tr></table></figure>
<p>DROP TABLE 为该表删除元数据和数据。数据实际上被转移到了。如果配置了垃圾(并没有指定清除)，则会使用垃圾/当前目录。元数据完全丢失了。<br>当删除一个外部表时，表中的数据将不会从文件系统中删除。</p>
<p>当删除一个由视图引用的表时，没有给出警告(视图被保留为无效的，并且必须由用户删除或重新创建)。<br>否则，表信息将从转移中删除，原始数据将被删除，就像“hadoop dfs-rm”一样。在许多情况下，这将导致表数据被移动到用户的.Trash 主目录中。因此，误删表的用户可以通过重新创建具有相同模式的表，重新创建任何必要的分区，然后使用Hadoop将数据重新移动到位置，从而能够恢复丢失的数据。这个解决方案随着时间的推移或跨安装的变化而变化，因为它依赖于底层实现;用户不可随意删除表.</p>
<p>如果指定了PURGE，表数据就不会进入.Trash/current user,也无法恢复因DROP误删的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*删除数据*/</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> table_name [<span class="keyword">PARTITION</span> partition_spec];</span><br><span class="line"></span><br><span class="line">partition_spec:</span><br><span class="line">  : (partition_column = partition_col_value, partition_column = partition_col_value, ...)</span><br></pre></td></tr></table></figure>
<p>从表或分区中删除所有行。如果文件系统的Trash被启用，这些行将被丢弃并放入Trash中,否则它们将被删除。当前目标表应该是native/managed 的表，否则将抛出一个异常。用户可以指定部分分区，同时删除多个分区，而省略分区则会截断表中的所有分区。<br>“auto.purge”属性如果设置为true,则直接删除数据,不放入回收站。建议设置为false。</p>
<h1 id="Beeline-命令行界面"><a href="#Beeline-命令行界面" class="headerlink" title="Beeline 命令行界面"></a>Beeline 命令行界面</h1><p>首先启动hiveserver2服务,再启动beeline,连接出错.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[main]: WARN jdbc.HiveConnection: Failed to connect to localhost:10000</span><br><span class="line">Error: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10000: Failed to open new session: java.lang.RuntimeException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.authorize.AuthorizationException): User: root is not allowed to impersonate scott (state=08S01,code=0)</span><br></pre></td></tr></table></figure>
<p>打开hadoop core-site.xml,添加下面信息,重新启动.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">``</span><br><span class="line">再次连接,正常进入</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">beeline&gt; !connect jdbc:hive2://localhost:10000 root 123456</span><br><span class="line">Connecting to jdbc:hive2://localhost:10000</span><br><span class="line">Connected to: Apache Hive (version 2.3.0)</span><br><span class="line">Driver: Hive JDBC (version 2.3.0)</span><br><span class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; show databases;</span><br><span class="line">+----------------+</span><br><span class="line">| database_name  |</span><br><span class="line">+----------------+</span><br><span class="line">| default        |</span><br><span class="line">| test           |</span><br><span class="line">| test2          |</span><br><span class="line">+----------------+</span><br><span class="line">3 rows selected (0.449 seconds)</span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; !help</span><br><span class="line">!addlocaldriverjar  Add driver jar file in the beeline client side.</span><br><span class="line">!addlocaldrivername Add driver name that needs to be supported in the beeline</span><br><span class="line">                    client side.</span><br><span class="line">!all                Execute the specified SQL against all the current connections</span><br><span class="line">!autocommit         Set autocommit mode on or off</span><br><span class="line">!batch              Start or execute a batch of statements</span><br><span class="line">!brief              Set verbose mode off</span><br><span class="line">!call               Execute a callable statement</span><br><span class="line">!close              Close the current connection to the database</span><br><span class="line">!closeall           Close all current open connections</span><br><span class="line">!columns            List all the columns for the specified table</span><br><span class="line">!commit             Commit the current transaction (if autocommit is off)</span><br><span class="line">!connect            Open a new connection to the database.</span><br><span class="line">!dbinfo             Give metadata information about the database</span><br><span class="line">!describe           Describe a table</span><br><span class="line">!dropall            Drop all tables in the current database</span><br><span class="line">!exportedkeys       List all the exported keys for the specified table</span><br><span class="line">!go                 Select the current connection</span><br><span class="line">!help               Print a summary of command usage</span><br><span class="line">!history            Display the command history</span><br><span class="line">!importedkeys       List all the imported keys for the specified table</span><br><span class="line">!indexes            List all the indexes for the specified table</span><br><span class="line">!isolation          Set the transaction isolation for this connection</span><br><span class="line">!list               List the current connections</span><br><span class="line">!manual             Display the BeeLine manual</span><br><span class="line">!metadata           Obtain metadata information</span><br><span class="line">!nativesql          Show the native SQL for the specified statement</span><br><span class="line">!nullemptystring    Set to true to get historic behavior of printing null as</span><br><span class="line">                    empty string. Default is false.</span><br><span class="line">!outputformat       Set the output format for displaying results</span><br><span class="line">                    (table,vertical,csv2,dsv,tsv2,xmlattrs,xmlelements, and</span><br><span class="line">                    deprecated formats(csv, tsv))</span><br><span class="line">!primarykeys        List all the primary keys for the specified table</span><br><span class="line">!procedures         List all the procedures</span><br><span class="line">!properties         Connect to the database specified in the properties file(s)</span><br><span class="line">!quit               Exits the program</span><br><span class="line">!reconnect          Reconnect to the database</span><br><span class="line">!record             Record all output to the specified file</span><br><span class="line">!rehash             Fetch table and column names for command completion</span><br><span class="line">!rollback           Roll back the current transaction (if autocommit is off)</span><br><span class="line">!run                Run a script from the specified file</span><br><span class="line">!save               Save the current variabes and aliases</span><br><span class="line">!scan               Scan for installed JDBC drivers</span><br><span class="line">!script             Start saving a script to a file</span><br><span class="line">!set                Set a beeline variable</span><br><span class="line">!sh                 Execute a shell command</span><br><span class="line">!sql                Execute a SQL command</span><br><span class="line">!tables             List all the tables in the database</span><br><span class="line">!typeinfo           Display the type map for the current connection</span><br><span class="line">!verbose            Set verbose mode on</span><br><span class="line"></span><br><span class="line">Comments, bug reports, and patches go to ???</span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; show tables;</span><br><span class="line">+-----------+</span><br><span class="line">| tab_name  |</span><br><span class="line">+-----------+</span><br><span class="line">| users     |</span><br><span class="line">+-----------+</span><br><span class="line">1 row selected (0.246 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; !quit</span><br><span class="line">Closing: 0: jdbc:hive2://localhost:10000</span><br></pre></td></tr></table></figure>
<h2 id="JAVA-API连接HIVE"><a href="#JAVA-API连接HIVE" class="headerlink" title="JAVA API连接HIVE"></a>JAVA API连接HIVE</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xwolf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiveLearn</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DRIVER_NAME = <span class="string">"org.apache.hive.jdbc.HiveDriver"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url = <span class="string">"jdbc:hive2://hadoop01:10000/default"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username = <span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password = <span class="string">"123456"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Statement statement = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(DRIVER_NAME);</span><br><span class="line">            connection = DriverManager.getConnection(url,username,password);</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有数据库信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getDatabases</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">"SHOW DATABASES"</span>;</span><br><span class="line">        List&lt;String&gt; databases = Lists.newArrayList();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ResultSet rs = statement.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">                databases.add(rs.getString(<span class="string">"database_name"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> databases;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><blockquote>
<ul>
<li>Hive权威指南</li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual" target="_blank" rel="noopener">LanguageManual</a></li>
<li><a href="http://www.hplsql.org/doc" target="_blank" rel="noopener">HPL/SQL-Procedural SQL on Hadoop,NoSQL and RDBMS</a></li>
<li><a href="https://hortonworks.com/blog/hive-0-14-cost-based-optimizer-cbo-technical-overview/" target="_blank" rel="noopener">Cost Based Optimizer (CBO) Technical Overview</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC#LanguageManualORC-HiveQLSyntax" target="_blank" rel="noopener">ORC Files</a></li>
<li><a href="https://en.wikipedia.org/wiki/RCFile" target="_blank" rel="noopener">RCFile</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/SerDe" target="_blank" rel="noopener">SerDe</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients#HiveServer2Clients-Beeline%E2%80%93CommandLineShell" target="_blank" rel="noopener">HiveServer2 Clients</a></li>
</ul>
</blockquote>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/hive/" rel="tag"># hive</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/11/C/C经典入门/" rel="next" title="C经典入门">
                <i class="fa fa-chevron-left"></i> C经典入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/16/distributed/Quartz并发问题/" rel="prev" title="Quartz 并发问题">
                Quartz 并发问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Xwolf</p>
              <div class="site-description motion-element" itemprop="description">JAVAEE、大数据、人工智能学习</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">238</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">68</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/xwolf191" title="GitHub &rarr; https://github.com/xwolf191" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/snowxwolf@foxmail.com" title="E-Mail &rarr; snowxwolf@foxmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#命令行界面"><span class="nav-number">2.</span> <span class="nav-text">命令行界面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据类型"><span class="nav-number">3.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive-DDL"><span class="nav-number">4.</span> <span class="nav-text">Hive DDL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库操作"><span class="nav-number">4.1.</span> <span class="nav-text">数据库操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表操作"><span class="nav-number">4.2.</span> <span class="nav-text">表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hive存储格式"><span class="nav-number">4.2.1.</span> <span class="nav-text">Hive存储格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#行格式化"><span class="nav-number">4.2.2.</span> <span class="nav-text">行格式化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#普通表-native-managed-TABLE"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">普通表(native/managed TABLE)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外部表"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">外部表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分区表"><span class="nav-number">4.2.2.3.</span> <span class="nav-text">分区表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桶表-Bucket-Table"><span class="nav-number">4.2.2.4.</span> <span class="nav-text">桶表(Bucket Table)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#临时表-Temporary-Table"><span class="nav-number">4.2.2.5.</span> <span class="nav-text">临时表(Temporary  Table)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Beeline-命令行界面"><span class="nav-number">5.</span> <span class="nav-text">Beeline 命令行界面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JAVA-API连接HIVE"><span class="nav-number">5.1.</span> <span class="nav-text">JAVA API连接HIVE</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#参考资料"><span class="nav-number">5.1.0.1.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xwolf</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">791k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">23:59</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>











  



  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/reading_progress/reading_progress.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'rqvt1pdlqsfcoMaUV34AtqwX-gzGzoHsz',
    appKey: '9d3lSojiD6ccALSPy1sDeQYe',
    placeholder: '^8^,不想说两句再走么?',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn'
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('5');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
